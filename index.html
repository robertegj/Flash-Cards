<!DOCTYPE html>
<html>
<head>
<style>
body {
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
#card-deck, #availableQuizes {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
}
#quizInput {
    width: 100%;
    height: 50vh;
}
.quizCard, .card {
    border: 1px solid black;
    box-shadow: 3px 4px 4px 1px rgba(55,55,55, 0.5);
    border-radius: 6px;
    width: 90vw;
    padding: 1em;
    margin: 1em;
    text-align: center;
    cursor: pointer;
}
.card {
    font-size: 3em;
    height: 50vh;
}
.card-font {
    font-style: italic;
}
.card-back {
    font-style: bold;
}
.hidden {
    display: none;
}
h1 {
    text-align: center;
}
#toolbelt {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background:rgba(55,55,55, 0.3);
}
#progress {
    background: green;
    height: 2em;
    border-right: 1px solid tan;
    border-top: 1px solid yellow;
    width: 0em;
}
.lightgreen {
    background: lightgreen;
}
.red {
    background: red;
    color: white;
}
</style>
</head>
<body>

    <div id="availableQuizes">
        <h1>Available Quizes</h1>
    </div>

    <div id="editQuiz">
        <h1>Custom Quiz</h1>
        <textarea id="quizInput" placeholder="Paste your quiz json here"></textarea>
        <br />
        <button onclick="startCustomQuiz()">Start Quiz</button>
    </div>

    <div id="quiz" style="display: none;">
        <div id="card-deck">

        </div>

        <div id="toolbelt">
            <div id="progress"></div>
            <p style="display:inline;">Quiz: <p id="title" style="display:inline;">Flash Card 3000</p></p>
            
            <p style="display:inline;">theme:</p><select id="theme" name="theme" style="display:inline;" onchange="changeTheme();">
                <option value="volvo">Volvo</option>
                <option value="saab">Saab</option>
                <option value="fiat">Fiat</option>
                <option value="Audi">Audi</option>
              </select>
            <button onclick="returnHome()" style="float:right;">Back Home</button>
            <button onclick="changeView(this)" style="float:right;">Multi Card</button>
        </div>
    </div>

</body>
<script>
function swapStyleSheet(sheet) {
    sheet = sheet + ".css";
    var element = document.createElement("link");
    element.setAttribute("rel", "stylesheet");
    element.setAttribute("type", "text/css");
    element.setAttribute("href", sheet);
    document.getElementsByTagName("head")[0].appendChild(element);
}
function changeTheme(){
    var theme = document.getElementById("theme").value;
    swapStyleSheet(theme);
    console.log(theme);
}
// Multi Card or Single Card view change function
function changeView(btn){
    var cards = document.getElementsByClassName("card");
    var card_width;
    var card_height;
    var card_font;
    if(btn.innerText=="Multi Card"){
        btn.innerText = "Single Card";
        card_width = "22vw";
        card_height = "auto";
        card_font = "1em";
    } else {
        btn.innerText = "Multi Card";
        card_width = "90vw";
        card_height = "50vh";
        card_font = "3em";
        
    }

    for(var i=0;i<cards.length;i++){
        cards[i].style.width = card_width;
        cards[i].style.height = card_height;
        cards[i].style.fontSize = card_font;

    }
}

function flipCard(event){
    if(event.shiftKey){
        this.classList.toggle("red");
        this.classList.remove("lightgreen");
    } else {
        if(!this.classList.contains("red")) {
        this.classList.toggle("lightgreen");
        }
        for(i=0;i<this.children.length;i++){
        this.children[i].classList.toggle("hidden");
        
    }

    }
    var amountDone = document.getElementsByClassName("lightgreen").length;
    var amountTodo = document.getElementsByClassName("card").length;

    var progress_percent = (amountDone / amountTodo) * 100;

    var progress_bar = document.getElementById("progress");
    progress_bar.style.width = progress_percent + "%";
}

function startCustomQuiz(){
    var currentQuiz = document.getElementById("quizInput").value;
    document.getElementById("availableQuizes").style.display = "none";
    loadQuiz(currentQuiz);
}

function loadQuiz(availableQuizes) {
    var availableQuizes = JSON.parse(availableQuizes);
    console.log("Loading Quiz: " + availableQuizes["title"]);

    var deck = document.getElementById("card-deck");

    for (var x = 0; x < availableQuizes["questions"].length; x++){
        var currentItem = availableQuizes["questions"][x];
        var quizCard = document.createElement("div");
        quizCard.className = "card";

        var cardFront = document.createElement("div");
        cardFront.className = "card-front";
        cardFront.innerText = Object.keys(currentItem);

        var cardBack = document.createElement("div");
        cardBack.className = "card-back";
        cardBack.classList.add("hidden");
        cardBack.innerText = Object.values(currentItem);

        quizCard.appendChild(cardFront);
        quizCard.appendChild(cardBack);
        quizCard.onclick = flipCard;
        document.getElementById("card-deck").appendChild(quizCard);
    }
    document.getElementById("editQuiz").style.display  = "none";
    document.getElementById("quiz").style.display  = "inline";
    document.getElementById("title").innerText = availableQuizes["title"];

    console.log("Loaded Quiz: " + availableQuizes["title"]);
}

function getJSON(url) {
        var resp ;
        var xmlHttp ;
        resp  = '' ;
        xmlHttp = new XMLHttpRequest();

        if(xmlHttp != null){
            xmlHttp.open( "GET", url, false );
            xmlHttp.send( null );
            resp = xmlHttp.responseText;
        }

        return resp;
    }

function quizClicked(){

    loadQuiz(getJSON(this.value));
    document.getElementById("availableQuizes").style.display = "none";
}

function loadQuizes(){
    var availableQuizes = JSON.parse(getJSON('./manifest.json'));
    console.log(availableQuizes);
    console.log(typeof(availableQuizes))
    for (var x = 0; x < availableQuizes["quizes"].length; x++){
        var currentItem = availableQuizes["quizes"][x];
        var quizCard = document.createElement("div");
        quizCard.className = "quizCard";
        console.log(currentItem);
        quizCard.innerText = Object.values(currentItem);
        quizCard.onclick = quizClicked;
        quizCard.value = Object.keys(currentItem);
        document.getElementById("availableQuizes").appendChild(quizCard);
    }
}

function returnHome(){
    document.getElementById("card-deck").innerText ="";
    document.getElementById("quiz").style.display = "none";
    document.getElementById("availableQuizes").style.display = "flex";
}

loadQuizes();

</script>
</html>
